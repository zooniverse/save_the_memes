// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var handleGenerate, randomElement;
    $.scrollIt();
    while ($('.perk-slider li.active').length < 4) {
      randomElement = Math.floor(Math.random() * $('.perk-slider li:not(.active)').length);
      $('.perk-slider li:not(.active)').eq(randomElement).addClass('active');
    }
    handleGenerate = function(e) {
      var downloadButton, form, imageContainer, loading, request;
      e.preventDefault();
      form = $('#generate-form').get(0);
      imageContainer = $('#image-container');
      downloadButton = $('#download');
      request = $.ajax({
        type: 'POST',
        url: '/',
        data: {
          url: form[0].value,
          topText: form[1].value,
          bottomText: form[2].value
        }
      });
      imageContainer.html('');
      loading = new Spinner().spin(imageContainer.get(0));
      request.done(function(_arg) {
        var img, url;
        url = _arg.url;
        img = new Image;
        img.onload = function() {
          loading.stop();
          imageContainer.html(img);
          downloadButton.show();
          return downloadButton.parent().first().attr('href', url);
        };
        img.src = url;
        return console.log('request success');
      });
      request.fail(function() {
        return console.log('failure');
      });
      return request.always(function() {
        return console.log('always');
      });
    };
    $('#generate').on('click', handleGenerate);
    $('#generate-form input').keypress(function(e) {
      if (e.which === 13) {
        e.preventDefault();
        return handleGenerate(e);
      }
    });
    return $(window).on('scroll', function(e) {
      var navigation;
      navigation = $('#navigation');
      if ($(window).scrollTop() > '800') {
        return navigation.css({
          "position": "fixed",
          "top": "0"
        });
      } else {
        return navigation.attr('style', '');
      }
    });
  });

}).call(this);
